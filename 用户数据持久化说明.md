# 用户数据持久化解决方案

## 问题描述
之前注册的用户数据只存储在内存中，重启 Mock 服务器后新注册的用户数据会丢失，导致无法使用注册的账户登录。

## 解决方案
现在已经实现了用户数据的持久化存储，具体改进包括：

### 1. 文件持久化存储
- 用户数据现在保存到 `userData.json` 文件中
- 每次注册新用户时自动保存到文件
- 服务器启动时自动加载已保存的用户数据
- 服务器关闭时确保数据被保存

### 2. 数据结构
保存的 `userData.json` 文件包含：
```json
{
  "users": {
    "username1": {
      "id": 1,
      "username": "username1",
      "email": "user@example.com",
      "password": "password",
      "permissions": [],
      "registeredAt": "2023-12-01"
    }
  },
  "userIdCounter": 4,
  "lastUpdated": "2023-12-01T10:00:00.000Z"
}
```

### 3. 核心功能
- **自动加载**: 服务器启动时自动从文件加载用户数据
- **自动保存**: 每次用户注册成功后立即保存到文件
- **优雅关闭**: 使用 Ctrl+C 关闭服务器时确保数据被保存
- **错误处理**: 如果文件读取失败，会使用默认用户数据

## 使用方法

### 1. 启动服务器
```bash
node mockServer.js
```

### 2. 测试功能
可以使用提供的测试脚本：
```bash
# 在另一个终端窗口运行
node test-persistence.js
```

### 3. 验证数据持久化
1. 启动 Mock 服务器
2. 注册一个新用户
3. 关闭服务器 (Ctrl+C)
4. 重新启动服务器
5. 使用注册的账户登录 - 应该成功！

## 控制台日志
服务器现在会显示详细的日志信息：
- 📂 从文件加载用户数据成功/失败
- 📝 使用默认用户数据
- 💾 用户数据已保存到文件
- ✅ 用户注册成功（包含详细用户信息）
- 🛑 服务器关闭时的数据保存状态

## 文件位置
- 用户数据文件：`userData.json`（项目根目录）
- 测试脚本：`test-persistence.js`（项目根目录）

## 注意事项
1. 不要手动删除 `userData.json` 文件，除非您想重置所有用户数据
2. 如果需要备份用户数据，请复制 `userData.json` 文件
3. 文件保存失败时注册仍然会成功，但数据只保存在内存中
4. 建议定期备份 `userData.json` 文件

## 测试步骤
1. 启动 Mock 服务器：`node mockServer.js`
2. 在前端注册一个新用户
3. 查看控制台日志确认数据保存成功
4. 关闭服务器 (Ctrl+C)
5. 重新启动服务器
6. 使用刚注册的账户登录 - 应该成功！

现在您的用户注册功能已经具备完整的数据持久化能力，重启服务器后注册的用户数据不会丢失。

## 卸载步骤
1. 停止 Mock 服务器
2. 删除 `userData.json` 文件
3. 删除 `test-persistence.js` 文件
4. 删除 `mockServer.js` 文件
5. npm uninstall express卸载命令
